<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fish Digital Twin QR System</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        const WEBSITE_URL = 'https://yourusername.github.io/fish-qr-system';

        const fishData = [
          {
            id: "A-1001",
            species: "Atlantic Cod",
            catchDate: "2025/11/28",
            location: "Gulf of Maine",
            processing: "Filet & Flash Frozen",
            quality: 5,
            temperature: "Maintained -18¬∞C throughout storage",
            notes: "Excellent, premium grade. Used for high-end restaurant supply.",
            blockchainHash: "0x7f9fade1c0d57a7af66ab4ead79fade1c0d57a7af66ab4ead7c2c2eb7b11a91385",
            color: 0x8B7355,
            size: 1.2
          },
          {
            id: "B-1002",
            species: "Sockeye Salmon",
            catchDate: "2025/11/29",
            location: "Alaska Peninsula",
            processing: "Whole, Gilled & Gutted",
            quality: 4,
            temperature: "Kept under 2¬∞C on ice slurry",
            notes: "Good fat content, eyes slightly cloudy due to ice contact. Very fresh.",
            blockchainHash: "0x3c2c2eb7b11a91385fade1c0d57a7af66ab4ead79fade1c0d57a7af66ab4ead7",
            color: 0xFF6B6B,
            size: 1.0
          },
          {
            id: "C-1003",
            species: "Yellowfin Tuna",
            catchDate: "2025/11/26",
            location: "Eastern Pacific",
            processing: "Loin, Vacuum Sealed",
            quality: 5,
            temperature: "-0.5¬∞C for chilling, air blast -35¬∞C freezing",
            notes: "Sushi-grade quality. Firm texture, vibrant red color. Traceable to vessel 'Sea Star'.",
            blockchainHash: "0x91385fade1c0d57a7af66ab4ead79fade1c0d57a7af66ab4ead7c2c2eb7b11a9",
            color: 0x4A90E2,
            size: 1.5
          },
          {
            id: "D-1004",
            species: "Farmed Tilapia",
            catchDate: "2025/11/30",
            location: "Aquaculture Pond 4",
            processing: "Live Harvest/Chilled",
            quality: 3,
            temperature: "Consistent 3¬∞C after harvest",
            notes: "Acceptable quality for general market. Slight feed discoloration near the gills.",
            blockchainHash: "0x4ead79fade1c0d57a7af66ab4ead7c2c2eb7b11a91385fade1c0d57a7af66ab4e",
            color: 0xD4AF37,
            size: 0.8
          },
          {
            id: "E-1005",
            species: "European Seabass",
            catchDate: "2025/11/27",
            location: "Mediterranean Sea",
            processing: "Whole, Cleaned, Iced",
            quality: 5,
            temperature: "Never exceeded 1¬∞C",
            notes: "Top-tier quality, certified sustainable catch. Clear eyes, bright red gills.",
            blockchainHash: "0x5fade1c0d57a7af66ab4ead7c2c2eb7b11a91385fade1c0d57a7af66ab4ead79f",
            color: 0xC0C0C0,
            size: 1.1
          },
          {
            id: "F-1006",
            species: "Haddock",
            catchDate: "2025/11/29",
            location: "North Atlantic",
            processing: "Fillet (Skin On)",
            quality: 4,
            temperature: "Held at 0¬∞C",
            notes: "Minor bruising on two pieces from net, but flesh is firm and white.",
            blockchainHash: "0x6ab4ead79fade1c0d57a7af66ab4ead7c2c2eb7b11a91385fade1c0d57a7af66a",
            color: 0x696969,
            size: 0.9
          },
          {
            id: "G-1007",
            species: "Pacific Halibut",
            catchDate: "2025/11/25",
            location: "Bering Sea",
            processing: "Steaks, Individually Wrapped",
            quality: 5,
            temperature: "Deep frozen at -30¬∞C",
            notes: "Highest grade. Perfect white meat. Harvested by long-line, low stress.",
            blockchainHash: "0x7c2c2eb7b11a91385fade1c0d57a7af66ab4ead79fade1c0d57a7af66ab4ead7c",
            color: 0xF5F5DC,
            size: 1.6
          },
          {
            id: "H-1008",
            species: "Mackerel",
            catchDate: "2025/11/28",
            location: "North Sea",
            processing: "Whole, Bulk Frozen",
            quality: 3,
            temperature: "Rapid freeze, held at -20¬∞C",
            notes: "Standard quality, good for processing. A few fish show signs of scale loss.",
            blockchainHash: "0x8fade1c0d57a7af66ab4ead7c2c2eb7b11a91385fade1c0d57a7af66ab4ead79",
            color: 0x4682B4,
            size: 0.7
          },
          {
            id: "I-1009",
            species: "Rainbow Trout",
            catchDate: "2025/11/30",
            location: "Local Fish Farm",
            processing: "Whole, Smoked",
            quality: 4,
            temperature: "Product finished smoking at 65¬∞C",
            notes: "Smoked on oak wood. Good moisture content, slight breakage on tail fin.",
            blockchainHash: "0x9a91385fade1c0d57a7af66ab4ead79fade1c0d57a7af66ab4ead7c2c2eb7b11a",
            color: 0xFF1493,
            size: 0.85
          },
          {
            id: "J-1010",
            species: "King Prawns",
            catchDate: "2025/11/27",
            location: "Southeast Asia",
            processing: "Shell-on, Cooked, Frozen",
            quality: 5,
            temperature: "Boiled then blast frozen to -18¬∞C",
            notes: "Excellent texture and color. Zero defects noted in inspection batch.",
            blockchainHash: "0xa66ab4ead79fade1c0d57a7af66ab4ead7c2c2eb7b11a91385fade1c0d57a7af6",
            color: 0xFF6347,
            size: 0.6
          }
        ];

        const Fish3DAvatar = ({ fish }) => {
          const mountRef = useRef(null);
          const sceneRef = useRef(null);
          const fishMeshRef = useRef(null);

          useEffect(() => {
            if (!mountRef.current) return;

            const scene = new THREE.Scene();
            scene.background = new THREE.Color(0x1e3a5f);
            sceneRef.current = scene;

            const camera = new THREE.PerspectiveCamera(
              75,
              mountRef.current.clientWidth / mountRef.current.clientHeight,
              0.1,
              1000
            );
            camera.position.z = 5;

            const renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(mountRef.current.clientWidth, mountRef.current.clientHeight);
            mountRef.current.appendChild(renderer.domElement);

            // Lighting
            const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
            scene.add(ambientLight);

            const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
            directionalLight.position.set(5, 5, 5);
            scene.add(directionalLight);

            // Create fish body
            const bodyGeometry = new THREE.SphereGeometry(fish.size, 32, 32);
            bodyGeometry.scale(1.8, 0.8, 0.6);
            const bodyMaterial = new THREE.MeshPhongMaterial({ 
              color: fish.color,
              shininess: 100,
              specular: 0x444444
            });
            const body = new THREE.Mesh(bodyGeometry, bodyMaterial);

            // Create tail
            const tailGeometry = new THREE.ConeGeometry(fish.size * 0.5, fish.size * 0.8, 3);
            tailGeometry.rotateZ(Math.PI / 2);
            const tailMaterial = new THREE.MeshPhongMaterial({ 
              color: fish.color,
              shininess: 80
            });
            const tail = new THREE.Mesh(tailGeometry, tailMaterial);
            tail.position.set(-fish.size * 1.5, 0, 0);

            // Create fins
            const finGeometry = new THREE.ConeGeometry(fish.size * 0.3, fish.size * 0.5, 3);
            const finMaterial = new THREE.MeshPhongMaterial({ color: fish.color });
            
            const topFin = new THREE.Mesh(finGeometry, finMaterial);
            topFin.position.set(0, fish.size * 0.8, 0);
            topFin.rotation.x = Math.PI;

            const sideFin1 = new THREE.Mesh(finGeometry, finMaterial);
            sideFin1.position.set(fish.size * 0.3, -fish.size * 0.4, fish.size * 0.4);
            sideFin1.rotation.z = Math.PI / 4;
            sideFin1.scale.set(0.6, 0.6, 0.6);

            const sideFin2 = new THREE.Mesh(finGeometry, finMaterial);
            sideFin2.position.set(fish.size * 0.3, -fish.size * 0.4, -fish.size * 0.4);
            sideFin2.rotation.z = Math.PI / 4;
            sideFin2.scale.set(0.6, 0.6, 0.6);

            // Create eyes
            const eyeGeometry = new THREE.SphereGeometry(fish.size * 0.15, 16, 16);
            const eyeMaterial = new THREE.MeshPhongMaterial({ color: 0xffffff });
            const pupilMaterial = new THREE.MeshPhongMaterial({ color: 0x000000 });

            const eye1 = new THREE.Mesh(eyeGeometry, eyeMaterial);
            eye1.position.set(fish.size * 1.2, fish.size * 0.3, fish.size * 0.3);

            const pupil1 = new THREE.Mesh(
              new THREE.SphereGeometry(fish.size * 0.08, 16, 16),
              pupilMaterial
            );
            pupil1.position.set(fish.size * 1.3, fish.size * 0.3, fish.size * 0.3);

            const eye2 = new THREE.Mesh(eyeGeometry, eyeMaterial);
            eye2.position.set(fish.size * 1.2, fish.size * 0.3, -fish.size * 0.3);

            const pupil2 = new THREE.Mesh(
              new THREE.SphereGeometry(fish.size * 0.08, 16, 16),
              pupilMaterial
            );
            pupil2.position.set(fish.size * 1.3, fish.size * 0.3, -fish.size * 0.3);

            // Group all parts
            const fishGroup = new THREE.Group();
            fishGroup.add(body);
            fishGroup.add(tail);
            fishGroup.add(topFin);
            fishGroup.add(sideFin1);
            fishGroup.add(sideFin2);
            fishGroup.add(eye1);
            fishGroup.add(eye2);
            fishGroup.add(pupil1);
            fishGroup.add(pupil2);

            scene.add(fishGroup);
            fishMeshRef.current = fishGroup;

            // Add bubbles
            const bubbles = [];
            for (let i = 0; i < 15; i++) {
              const bubbleGeometry = new THREE.SphereGeometry(0.1 + Math.random() * 0.1, 16, 16);
              const bubbleMaterial = new THREE.MeshPhongMaterial({ 
                color: 0xadd8e6,
                transparent: true,
                opacity: 0.4
              });
              const bubble = new THREE.Mesh(bubbleGeometry, bubbleMaterial);
              bubble.position.set(
                Math.random() * 8 - 4,
                Math.random() * 6 - 3,
                Math.random() * 6 - 3
              );
              scene.add(bubble);
              bubbles.push({ mesh: bubble, speed: 0.01 + Math.random() * 0.02 });
            }

            // Animation
            let time = 0;
            const animate = () => {
              requestAnimationFrame(animate);
              time += 0.01;

              if (fishMeshRef.current) {
                fishMeshRef.current.rotation.y = Math.sin(time * 0.5) * 0.3;
                fishMeshRef.current.position.y = Math.sin(time) * 0.3;
                fishMeshRef.current.position.x = Math.cos(time * 0.3) * 0.5;

                // Animate tail
                tail.rotation.y = Math.sin(time * 5) * 0.3;
              }

              // Animate bubbles
              bubbles.forEach(bubble => {
                bubble.mesh.position.y += bubble.speed;
                if (bubble.mesh.position.y > 3) {
                  bubble.mesh.position.y = -3;
                }
              });

              renderer.render(scene, camera);
            };

            animate();

            const handleResize = () => {
              if (mountRef.current) {
                camera.aspect = mountRef.current.clientWidth / mountRef.current.clientHeight;
                camera.updateProjectionMatrix();
                renderer.setSize(mountRef.current.clientWidth, mountRef.current.clientHeight);
              }
            };

            window.addEventListener('resize', handleResize);

            return () => {
              window.removeEventListener('resize', handleResize);
              mountRef.current?.removeChild(renderer.domElement);
            };
          }, [fish]);

          return <div ref={mountRef} style={{ width: '100%', height: '400px', borderRadius: '12px', overflow: 'hidden' }} />;
        };

        const QRCodeGenerator = ({ data, onDownload }) => {
          const qrData = `${WEBSITE_URL}/?id=${data.id}`;
          const qrUrl = `https://api.qrserver.com/v1/create-qr-code/?size=400x400&data=${encodeURIComponent(qrData)}`;
          
          return (
            <div className="flex flex-col items-center gap-2 p-4 bg-white rounded-lg border-2 border-gray-200">
              <img src={qrUrl} alt={`QR Code for ${data.id}`} className="w-48 h-48" />
              <div className="text-sm font-mono text-gray-600">{data.id}</div>
              <button
                onClick={(e) => {
                  e.stopPropagation();
                  onDownload(data, qrUrl);
                }}
                className="mt-2 px-4 py-1 bg-blue-600 text-white rounded-md text-sm hover:bg-blue-700"
              >
                üì• Download
              </button>
            </div>
          );
        };

        const BlockchainVerification = ({ fish }) => {
          const [verified, setVerified] = useState(false);
          const [verifying, setVerifying] = useState(false);

          const handleVerify = () => {
            setVerifying(true);
            setTimeout(() => {
              setVerifying(false);
              setVerified(true);
            }, 1500);
          };

          return (
            <div className="bg-gradient-to-r from-purple-50 to-indigo-50 rounded-lg p-4 border-2 border-purple-200">
              <div className="flex items-center gap-2 text-purple-700 font-semibold mb-3">
                <span>üõ°Ô∏è</span> Blockchain Verification
              </div>
              
              <div className="space-y-3">
                <div className="bg-white rounded p-3">
                  <p className="text-xs text-gray-500 mb-1">Transaction Hash</p>
                  <p className="font-mono text-xs break-all text-gray-700">{fish.blockchainHash}</p>
                </div>
                
                <div className="bg-white rounded p-3">
                  <p className="text-xs text-gray-500 mb-1">Block Number</p>
                  <p className="font-mono text-sm text-gray-700">#{Math.floor(Math.random() * 1000000) + 15000000}</p>
                </div>

                {verified && (
                  <div className="bg-green-100 border-2 border-green-500 rounded p-3 flex items-center gap-2">
                    <span>‚úÖ</span>
                    <div>
                      <p className="font-semibold text-green-800">Verified on Blockchain</p>
                      <p className="text-xs text-green-700">Authentic and tamper-proof</p>
                    </div>
                  </div>
                )}

                <button
                  onClick={handleVerify}
                  disabled={verified || verifying}
                  className={`w-full py-2 rounded-lg font-semibold transition-all ${
                    verified
                      ? 'bg-green-600 text-white cursor-not-allowed'
                      : verifying
                      ? 'bg-purple-400 text-white cursor-wait'
                      : 'bg-purple-600 text-white hover:bg-purple-700'
                  }`}
                >
                  {verifying ? 'Verifying...' : verified ? '‚úì Verified' : 'Verify on Blockchain'}
                </button>
              </div>
            </div>
          );
        };

        const FishDigitalTwin = ({ fish }) => {
          const qualityColor = fish.quality >= 5 ? 'text-green-600' : fish.quality >= 4 ? 'text-blue-600' : 'text-yellow-600';
          
          return (
            <div className="space-y-6">
              <div className="bg-gradient-to-br from-blue-900 via-blue-800 to-cyan-900 rounded-xl p-6 border-2 border-blue-300 shadow-2xl">
                <div className="flex items-start justify-between mb-4">
                  <div>
                    <h2 className="text-3xl font-bold text-white flex items-center gap-2">
                      <span>üêü</span> {fish.species}
                    </h2>
                    <p className="text-sm text-blue-200 font-mono mt-1">Digital Twin ID: {fish.id}</p>
                  </div>
                  <div className={`flex items-center gap-1 text-2xl ${qualityColor}`}>
                    {[...Array(5)].map((_, i) => (
                      <span key={i}>{i < fish.quality ? '‚òÖ' : '‚òÜ'}</span>
                    ))}
                  </div>
                </div>

                <Fish3DAvatar fish={fish} />

                <div className="mt-4 text-center text-white text-sm bg-blue-800 bg-opacity-50 rounded-lg p-3">
                  <p className="font-semibold">üåä Interactive 3D Digital Twin</p>
                  <p className="text-xs text-blue-200">Watch the fish swim in real-time simulation</p>
                </div>
              </div>

              <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div className="bg-white rounded-lg p-4 shadow-lg border-2 border-blue-200">
                  <div className="text-blue-700 font-semibold mb-2 flex items-center gap-2">
                    <span>üìç</span> Catch Information
                  </div>
                  <div className="space-y-1 text-sm">
                    <p><span className="font-medium">Date:</span> {fish.catchDate}</p>
                    <p><span className="font-medium">Location:</span> {fish.location}</p>
                  </div>
                </div>

                <div className="bg-white rounded-lg p-4 shadow-lg border-2 border-blue-200">
                  <div className="text-blue-700 font-semibold mb-2 flex items-center gap-2">
                    <span>üì¶</span> Processing
                  </div>
                  <div className="space-y-1 text-sm">
                    <p>{fish.processing}</p>
                  </div>
                </div>

                <div className="bg-white rounded-lg p-4 shadow-lg border-2 border-blue-200">
                  <div className="text-blue-700 font-semibold mb-2 flex items-center gap-2">
                    <span>üå°Ô∏è</span> Temperature Log
                  </div>
                  <div className="space-y-1 text-sm">
                    <p>{fish.temperature}</p>
                  </div>
                </div>

                <div className="bg-white rounded-lg p-4 shadow-lg border-2 border-blue-200">
                  <div className="text-blue-700 font-semibold mb-2 flex items-center gap-2">
                    <span>‚ÑπÔ∏è</span> Quality Notes
                  </div>
                  <div className="space-y-1 text-sm">
                    <p>{fish.notes}</p>
                  </div>
                </div>

                <div className="md:col-span-2">
                  <BlockchainVerification fish={fish} />
                </div>
              </div>
            </div>
          );
        };

        const App = () => {
          const [view, setView] = useState('qr-grid');
          const [selectedFish, setSelectedFish] = useState(null);
          
          useEffect(() => {
            const urlParams = new URLSearchParams(window.location.search);
            const fishId = urlParams.get('id');
            
            if (fishId) {
              const fish = fishData.find(f => f.id === fishId);
              if (fish) {
                setSelectedFish(fish);
                setView('digital-twin');
              }
            }
          }, []);

          const handleQRClick = (fish) => {
            setSelectedFish(fish);
            setView('digital-twin');
          };

          const downloadQR = (fish, qrUrl) => {
            const link = document.createElement('a');
            link.href = qrUrl;
            link.download = `QR-${fish.id}-${fish.species.replace(/\s+/g, '-')}.png`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
          };

          const downloadAllQRs = () => {
            fishData.forEach((fish, index) => {
              setTimeout(() => {
                const qrData = `${WEBSITE_URL}/?id=${fish.id}`;
                const qrUrl = `https://api.qrserver.com/v1/create-qr-code/?size=400x400&data=${encodeURIComponent(qrData)}`;
                downloadQR(fish, qrUrl);
              }, index * 500);
            });
          };

          return (
            <div className="min-h-screen bg-gradient-to-b from-blue-100 to-cyan-100 p-8">
              <div className="max-w-7xl mx-auto">
                <div className="text-center mb-8">
                  <h1 className="text-4xl font-bold text-gray-800 mb-2 flex items-center justify-center gap-3">
                    <span>üêü</span> Fish Digital Twin System
                  </h1>
                  <p className="text-gray-600">Scan QR codes to view 3D fish avatars with complete traceability</p>
                </div>

                <div className="flex gap-4 justify-center mb-8 flex-wrap">
                  <button
                    onClick={() => setView('qr-grid')}
                    className={`px-6 py-2 rounded-lg font-semibold transition-all ${
                      view === 'qr-grid'
                        ? 'bg-blue-600 text-white shadow-lg'
                        : 'bg-white text-gray-700 hover:bg-gray-50'
                    }`}
                  >
                    üì± QR Codes
                  </button>
                  <button
                    onClick={() => setView('digital-twin')}
                    className={`px-6 py-2 rounded-lg font-semibold transition-all ${
                      view === 'digital-twin'
                        ? 'bg-blue-600 text-white shadow-lg'
                        : 'bg-white text-gray-700 hover:bg-gray-50'
                    }`}
                    disabled={!selectedFish}
                  >
                    üêü 3D Digital Twin
                  </button>
                </div>

                {view === 'qr-grid' && (
                  <div>
                    <div className="mb-6 text-center">
                      <button
                        onClick={downloadAllQRs}
                        className="px-6 py-3 bg-purple-600 text-white rounded-lg font-semibold hover:bg-purple-700 shadow-lg"
                      >
                        üì• Download All QR Codes
                      </button>
                    </div>

                    <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-5 gap-6">
                      {fishData.map((fish) => (
                        <div
                          key={fish.id}
                          onClick={() => handleQRClick(fish)}
                          className="cursor-pointer transform transition-all hover:scale-105 hover:shadow-xl"
                        >
                          <QRCodeGenerator data={fish} onDownload={downloadQR} />
                          <div className="text-center mt-2 font-semibold text-gray-700">
                            {fish.species}
                          </div>
                        </div>
                      ))}
                    </div>
                    
                    <div className="mt-8 text-center text-sm text-gray-600 bg-white rounded-lg p-4 shadow-sm">
                      <p className="font-semibold mb-2">üì± How to use:</p>
                      <p>Click on any QR code to see the 3D digital twin avatar of the fish!</p>
                      <p className="mt-2">Each fish has a unique 3D model that swims in real-time.</p>
                    </div>
                  </div>
                )}

                {view === 'digital-twin' && selectedFish && (
                  <div className="max-w-5xl mx-auto">
                    <FishDigitalTwin fish={selectedFish} />
                    <div className="mt-6 text-center">
                      <button
                        onClick={() => setView('qr-grid')}
                        className="px-6 py-2 bg-white text-gray-700 rounded-lg font-semibold hover:bg-gray-50 shadow-md"
                      >
                        ‚Üê Back to QR Codes
                      </button>
                    </div>
                  </div>
                )}
              </div>
            </div>
          );
        };

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
